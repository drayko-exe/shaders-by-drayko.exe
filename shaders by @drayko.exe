local Players = game:GetService("Players")
local Lighting = game:GetService("Lighting")
local Workspace = game:GetService("Workspace")

local player = Players.LocalPlayer
local assetId = 17279880951

-----------------------------
-- 1. FUNÇÃO DE TRANSFORMAÇÃO
-----------------------------
-- Criamos uma função separada para poder chamar tanto no início quanto quando algo novo surgir
local function processObject(obj)
    if obj:IsA("BasePart") then
        obj.Material = Enum.Material.SmoothPlastic
        if obj.Transparency == 0 then
            obj.Reflectance = 0.6
        end
    end
end

-- Processa o que já existe
task.spawn(function()
    for _, obj in pairs(Workspace:GetDescendants()) do
        processObject(obj)
    end
end)

-- ESCUTADOR: Toda vez que o mapa mudar ou algo novo for criado, ele limpa/transforma
Workspace.DescendantAdded:Connect(function(obj)
    processObject(obj)
end)

-----------------------------
-- 2. ILUMINAÇÃO REUTILIZÁVEL
-----------------------------
local function applyLighting()
    -- Limpa efeitos antigos para não acumular
    for _, obj in pairs(Lighting:GetChildren()) do
        if obj:IsA("Sky") or obj:IsA("BloomEffect") or obj:IsA("Atmosphere") or obj:IsA("Clouds") then
            obj:Destroy()
        end
    end

    -- Carrega Asset
    pcall(function()
        local objects = game:GetObjects("rbxassetid://" .. assetId)
        for _, item in ipairs(objects) do
            item.Parent = Lighting
        end
    end)

    -- Configurações de Iluminação (Forçadas)
    Lighting.Technology = Enum.Technology.Future
    Lighting.Brightness = 2.2
    Lighting.GlobalShadows = true
    Lighting.OutdoorAmbient = Color3.fromRGB(170, 130, 255)
    
    -- Garante que o Sky permaneça mesmo se o mapa mudar
    if not Lighting:FindFirstChildOfClass("Sky") then
        local sky = Instance.new("Sky", Lighting)
        sky.SkyboxUp = "rbxassetid://159067921"
        sky.SunAngularSize = 0
    end
end

-- Aplica a primeira vez
applyLighting()

-- Se o jogo resetar a iluminação (comum em mudanças de mapa), ele reaplica
Lighting.Changed:Connect(function(prop)
    if prop == "Brightness" or prop == "ClockTime" then
        -- Pequeno delay para não dar lag se o jogo mudar muitas propriedades de uma vez
        task.wait(1) 
        if Lighting.Brightness ~= 2.2 then
            applyLighting()
        end
    end
end)

-----------------------------
-- 3. OUTLINE (PERSONAGEM)
-----------------------------
local function addOutline(character)
    if not character then return end
    local humanoid = character:WaitForChild("Humanoid", 10)
    
    -- Limpeza de Highlights antigos
    for _, old in pairs(character:GetChildren()) do
        if old:IsA("Highlight") then old:Destroy() end
    end

    local highlight = Instance.new("Highlight")
    highlight.Name = "SkinOutline"
    highlight.FillTransparency = 1
    highlight.OutlineColor = Color3.fromRGB(255, 255, 255)
    highlight.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop
    highlight.Parent = character
end

player.CharacterAdded:Connect(addOutline)
if player.Character then addOutline(player.Character) end
